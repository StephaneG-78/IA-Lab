
<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <base target="_self">
    <title>Concertation Publique</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/@preline/preline@2.0.0/dist/preline.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script>
        tailwind.config = {
            darkMode: 'class',
            theme: {
                extend: {
                    colors: {
                        primary: {"50":"#eff6ff","100":"#dbeafe","200":"#bfdbfe","300":"#93c5fd","400":"#60a5fa","500":"#3b82f6","600":"#2563eb","700":"#1d4ed8","800":"#1e40af","900":"#1e3a8a"}
                    }
                }
            }
        }
    </script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in-out;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .file-input-label {
            transition: all 0.3s ease;
        }
        .file-input-label:hover {
            background-color: #f3f4f6;
        }
        .dark .file-input-label:hover {
            background-color: #374151;
        }
    </style>
</head>
<body class="bg-gray-50 dark:bg-gray-900 transition-colors duration-200">
    <div class="min-h-screen">
        <!-- Header -->
        <header class="bg-white dark:bg-gray-800 shadow-sm">
            <div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-6">
                <h1 class="text-3xl font-bold text-gray-900 dark:text-white">Concertation Publique</h1>
                <p class="mt-2 text-gray-600 dark:text-gray-300">Partagez vos questions et contributions avec nous</p>
            </div>
        </header>

        <!-- Main Content -->
        <main class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8">
            <!-- Participation Form -->
            <section id="participation-form" class="mb-12 bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                <h2 class="text-2xl font-semibold text-gray-900 dark:text-white mb-6">Participer</h2>
                
                <form id="consultation-form" class="space-y-6">
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                        <div>
                            <label for="pseudo" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                Pseudo <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="pseudo" name="pseudo" required
                                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white">
                        </div>
                        
                        <div>
                            <label for="ville" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                                Ville <span class="text-red-500">*</span>
                            </label>
                            <input type="text" id="ville" name="ville" required
                                class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white">
                        </div>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Vous souhaitez poster une : <span class="text-red-500">*</span>
                        </label>
                        <div class="mt-1 space-y-2">
                            <div class="flex items-center">
                                <input id="question" name="type" type="radio" value="Question" checked
                                    class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 dark:border-gray-600 dark:bg-gray-700">
                                <label for="question" class="ml-3 block text-sm text-gray-700 dark:text-gray-300">
                                    Question
                                </label>
                            </div>
                            <div class="flex items-center">
                                <input id="contribution" name="type" type="radio" value="Contribution"
                                    class="h-4 w-4 text-primary-600 focus:ring-primary-500 border-gray-300 dark:border-gray-600 dark:bg-gray-700">
                                <label for="contribution" class="ml-3 block text-sm text-gray-700 dark:text-gray-300">
                                    Contribution
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <div>
                        <label for="titre" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Titre de votre message <span class="text-red-500">*</span>
                        </label>
                        <input type="text" id="titre" name="titre" required
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white">
                    </div>
                    
                    <div>
                        <label for="message" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Votre message <span class="text-red-500">*</span>
                        </label>
                        <textarea id="message" name="message" rows="4" required
                            class="w-full px-4 py-2 border border-gray-300 dark:border-gray-600 rounded-md shadow-sm focus:ring-primary-500 focus:border-primary-500 dark:bg-gray-700 dark:text-white"></textarea>
                    </div>
                    
                    <div>
                        <label class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-1">
                            Joindre un fichier PDF (optionnel)
                        </label>
                        <div class="mt-1 flex items-center">
                            <label for="file-upload" class="file-input-label cursor-pointer rounded-md bg-white dark:bg-gray-700 font-medium text-primary-600 dark:text-primary-400 hover:text-primary-500 dark:hover:text-primary-300 focus-within:outline-none focus-within:ring-2 focus-within:ring-offset-2 focus-within:ring-primary-500 border border-gray-300 dark:border-gray-600 px-4 py-2">
                                <span>Choisir un fichier</span>
                                <input id="file-upload" name="file-upload" type="file" accept=".pdf" class="sr-only">
                            </label>
                            <span id="file-name" class="ml-2 text-sm text-gray-500 dark:text-gray-400">Aucun fichier sélectionné</span>
                        </div>
                        <p class="mt-1 text-xs text-gray-500 dark:text-gray-400">PDF uniquement, max 10 Mo</p>
                    </div>
                    
                    <div class="pt-2">
                        <button type="submit"
                            class="w-full md:w-auto inline-flex justify-center py-2 px-6 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200">
                            Valider ma participation
                        </button>
                    </div>
                </form>
                
                <!-- Success Message (hidden by default) -->
                <div id="success-message" class="hidden mt-6 p-4 bg-green-50 dark:bg-green-900 border border-green-200 dark:border-green-700 rounded-md">
                    <div class="flex">
                        <div class="flex-shrink-0">
                            <i class="fas fa-check-circle h-5 w-5 text-green-600 dark:text-green-400"></i>
                        </div>
                        <div class="ml-3">
                            <h3 class="text-sm font-medium text-green-800 dark:text-green-200">Merci pour votre participation !</h3>
                            <div class="mt-2 text-sm text-green-700 dark:text-green-300">
                                <p>Votre message a bien été enregistré et sera publié après modération.</p>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Filter Section -->
            <section class="mb-8">
                <div class="bg-white dark:bg-gray-800 rounded-lg shadow-md p-6">
                    <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-4">Filtrer les participations</h2>
                    <div class="flex flex-col md:flex-row md:items-center md:space-x-4 space-y-4 md:space-y-0">
                        <div class="flex-1">
                            <label for="search" class="sr-only">Rechercher</label>
                            <div class="relative rounded-md shadow-sm">
                                <div class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none">
                                    <i class="fas fa-search text-gray-400"></i>
                                </div>
                                <input type="text" name="search" id="search" placeholder="Rechercher par titre ou contenu"
                                    class="focus:ring-primary-500 focus:border-primary-500 block w-full pl-10 sm:text-sm border-gray-300 dark:border-gray-600 rounded-md dark:bg-gray-700 dark:text-white">
                            </div>
                        </div>
                        <div>
                            <label for="type-filter" class="sr-only">Type</label>
                            <select id="type-filter" name="type-filter"
                                class="focus:ring-primary-500 focus:border-primary-500 block w-full pl-3 pr-10 py-2 text-base border-gray-300 dark:border-gray-600 focus:outline-none sm:text-sm rounded-md dark:bg-gray-700 dark:text-white">
                                <option value="all">Tous les types</option>
                                <option value="Question">Questions</option>
                                <option value="Contribution">Contributions</option>
                            </select>
                        </div>
                        <div>
                            <button id="apply-filters" type="button"
                                class="inline-flex items-center px-4 py-2 border border-transparent text-sm font-medium rounded-md shadow-sm text-white bg-primary-600 hover:bg-primary-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-primary-500 transition-colors duration-200">
                                Appliquer
                            </button>
                        </div>
                    </div>
                </div>
            </section>

            <!-- Participations List -->
            <section id="participations-list">
                <h2 class="text-2xl font-semibold text-gray-900 dark:text-white mb-6">Dernières participations</h2>
                
                <div id="participations-container" class="space-y-6">
                    <!-- Participations will be dynamically inserted here -->
                </div>
                
                <div id="no-results" class="hidden text-center py-12">
                    <i class="fas fa-inbox text-4xl text-gray-400 mb-4"></i>
                    <h3 class="text-lg font-medium text-gray-900 dark:text-white">Aucune participation trouvée</h3>
                    <p class="mt-1 text-gray-500 dark:text-gray-400">Essayez de modifier vos critères de recherche</p>
                </div>
            </section>
        </main>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Sample data - in a real implementation, this would come from a database
            const participations = [
                {
                    id: 1,
                    pseudo: "Citoyen123",
                    ville: "Paris",
                    type: "Question",
                    titre: "Quand seront réalisés les travaux ?",
                    message: "Je souhaiterais savoir quand seront réalisés les travaux prévus dans le quartier. Y aura-t-il des perturbations pour les riverains ?",
                    date: "2023-06-15T14:32:00",
                    fichier: null,
                    reponse: {
                        date: "2023-06-17T09:15:00",
                        message: "Les travaux sont prévus pour débuter le 15 juillet et devraient durer environ 3 mois. Des informations détaillées sur les perturbations seront communiquées aux riverains 15 jours avant le début des travaux."
                    }
                },
                {
                    id: 2,
                    pseudo: "MarieD",
                    ville: "Lyon",
                    type: "Contribution",
                    titre: "Proposition pour le parc municipal",
                    message: "Je propose d'ajouter plus de bancs dans le parc municipal, particulièrement près des aires de jeux pour enfants. Cela permettrait aux parents de s'asseoir pendant que leurs enfants jouent.",
                    date: "2023-06-10T11:45:00",
                    fichier: "proposition_parc.pdf",
                    reponse: null
                },
                {
                    id: 3,
                    pseudo: "JeanP",
                    ville: "Marseille",
                    type: "Question",
                    titre: "Horaires de la bibliothèque",
                    message: "Est-il prévu d'étendre les horaires d'ouverture de la bibliothèque centrale, notamment le week-end ?",
                    date: "2023-06-05T16:20:00",
                    fichier: null,
                    reponse: {
                        date: "2023-06-08T10:05:00",
                        message: "Une étude est en cours pour évaluer la possibilité d'étendre les horaires d'ouverture. Les résultats seront présentés lors du prochain conseil municipal."
                    }
                }
            ];

            // DOM elements
            const form = document.getElementById('consultation-form');
            const fileInput = document.getElementById('file-upload');
            const fileNameDisplay = document.getElementById('file-name');
            const successMessage = document.getElementById('success-message');
            const participationsContainer = document.getElementById('participations-container');
            const noResultsMessage = document.getElementById('no-results');
            const searchInput = document.getElementById('search');
            const typeFilter = document.getElementById('type-filter');
            const applyFiltersButton = document.getElementById('apply-filters');

            // Handle file input change
            fileInput.addEventListener('change', function() {
                if (this.files.length > 0) {
                    fileNameDisplay.textContent = this.files[0].name;
                } else {
                    fileNameDisplay.textContent = 'Aucun fichier sélectionné';
                }
            });

            // Handle form submission
            form.addEventListener('submit', function(e) {
                e.preventDefault();
                
                // Validate file if present
                if (fileInput.files.length > 0) {
                    const file = fileInput.files[0];
                    if (file.size > 10 * 1024 * 1024) {
                        alert('Le fichier ne doit pas dépasser 10 Mo');
                        return;
                    }
                    if (file.type !== 'application/pdf') {
                        alert('Seuls les fichiers PDF sont acceptés');
                        return;
                    }
                }
                
                // In a real implementation, you would send the form data to your server here
                // For this demo, we'll just show the success message
                
                // Reset form
                form.reset();
                fileNameDisplay.textContent = 'Aucun fichier sélectionné';
                
                // Show success message
                successMessage.classList.remove('hidden');
                
                // Hide success message after 5 seconds
                setTimeout(() => {
                    successMessage.classList.add('hidden');
                }, 5000);
            });

            // Render participations
            function renderParticipations(filteredParticipations = participations) {
                participationsContainer.innerHTML = '';
                
                if (filteredParticipations.length === 0) {
                    noResultsMessage.classList.remove('hidden');
                    return;
                } else {
                    noResultsMessage.classList.add('hidden');
                }
                
                filteredParticipations.forEach(participation => {
                    const participationElement = document.createElement('div');
                    participationElement.className = 'bg-white dark:bg-gray-800 rounded-lg shadow-md p-6 fade-in';
                    
                    const date = new Date(participation.date);
                    const formattedDate = date.toLocaleDateString('fr-FR', {
                        day: '2-digit',
                        month: '2-digit',
                        year: 'numeric',
                        hour: '2-digit',
                        minute: '2-digit'
                    });
                    
                    let html = `
                        <div class="flex justify-between items-start">
                            <div>
                                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${participation.type === 'Question' ? 'bg-blue-100 dark:bg-blue-900 text-blue-800 dark:text-blue-200' : 'bg-green-100 dark:bg-green-900 text-green-800 dark:text-green-200'}">
                                    ${participation.type}
                                </span>
                                <h3 class="mt-2 text-lg font-medium text-gray-900 dark:text-white">${participation.titre}</h3>
                            </div>
                            <span class="text-sm text-gray-500 dark:text-gray-400">${formattedDate}</span>
                        </div>
                        <div class="mt-4 flex items-center text-sm text-gray-500 dark:text-gray-400">
                            <i class="fas fa-user mr-1"></i>
                            <span class="mr-4">${participation.pseudo}</span>
                            <i class="fas fa-map-marker-alt mr-1"></i>
                            <span>${participation.ville}</span>
                        </div>
                        <div class="mt-4 text-gray-700 dark:text-gray-300">
                            <p>${participation.message}</p>
                        </div>
                    `;
                    
                    if (participation.fichier) {
                        html += `
                            <div class="mt-4">
                                <a href="#" class="inline-flex items-center text-primary-600 dark:text-primary-400 hover:text-primary-500 dark:hover:text-primary-300">
                                    <i class="fas fa-file-pdf mr-2"></i>
                                    ${participation.fichier}
                                </a>
                            </div>
                        `;
                    }
                    
                    if (participation.reponse) {
                        const responseDate = new Date(participation.reponse.date);
                        const formattedResponseDate = responseDate.toLocaleDateString('fr-FR', {
                            day: '2-digit',
                            month: '2-digit',
                            year: 'numeric',
                            hour: '2-digit',
                            minute: '2-digit'
                        });
                        
                        html += `
                            <div class="mt-6 pt-6 border-t border-gray-200 dark:border-gray-700">
                                <div class="flex items-center">
                                    <div class="flex-shrink-0 bg-primary-500 rounded-full p-1">
                                        <i class="fas fa-reply h-4 w-4 text-white"></i>
                                    </div>
                                    <div class="ml-3">
                                        <h4 class="text-sm font-medium text-gray-900 dark:text-white">Réponse de la mairie</h4>
                                        <div class="mt-1 text-xs text-gray-500 dark:text-gray-400">${formattedResponseDate}</div>
                                    </div>
                                </div>
                                <div class="mt-4 pl-9 text-gray-700 dark:text-gray-300">
                                    <p>${participation.reponse.message}</p>
                                </div>
                            </div>
                        `;
                    }
                    
                    participationElement.innerHTML = html;
                    participationsContainer.appendChild(participationElement);
                });
            }

            // Filter participations
            function filterParticipations() {
                const searchTerm = searchInput.value.toLowerCase();
                const typeFilterValue = typeFilter.value;
                
                const filtered = participations.filter(participation => {
                    const matchesSearch = participation.titre.toLowerCase().includes(searchTerm) || 
                                          participation.message.toLowerCase().includes(searchTerm);
                    const matchesType = typeFilterValue === 'all' || participation.type === typeFilterValue;
                    
                    return matchesSearch && matchesType;
                });
                
                renderParticipations(filtered);
            }

            // Initial render
            renderParticipations();

            // Event listeners for filters
            applyFiltersButton.addEventListener('click', filterParticipations);
            
            // Also filter when pressing Enter in search input
            searchInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') {
                    filterParticipations();
                }
            });

            // Prevent default behavior for all anchor tags
            document.querySelectorAll('a').forEach(anchor => {
                anchor.addEventListener('click', function(e) {
                    e.preventDefault();
                    // In a real implementation, you might handle navigation here
                    console.log('Navigation prevented for:', this.href);
                });
            });
        });
    </script>
</body>
</html>
